this.Map_Form=function(){function t(){}return t.maxPointForm=10,t.deleteMessage="\u30de\u30fc\u30ab\u30fc\u3092\u524a\u9664\u3057\u3066\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",t.dataID=0,t.clickIcon="//maps.google.com/mapfiles/ms/icons/blue-dot.png",t.clickMarker=null,t.setMapLoc=function(a,e,o){e=Math.ceil(e*Math.pow(10,6))/Math.pow(10,6),o=Math.ceil(o*Math.pow(10,6))/Math.pow(10,6),a.val(e.toFixed(6)+","+o.toFixed(6))},t.getMapLoc=function(a){var e;return e=a.val().split(","),new google.maps.LatLng(parseFloat(e[0]),parseFloat(e[1]))},t.validateLoc=function(a){var e,o,r;return o=a.val().split(","),e=parseFloat(o[0]),r=parseFloat(o[1]),!(!e||isNaN(e))&&(!(!r||isNaN(r))&&(-90<=e&&e<=90&&-180<=r&&r<=180))},t.attachMessage=function(r){google.maps.event.addListener(Googlemaps_Map.markers[r],"click",function(){Googlemaps_Map.openedInfo&&Googlemaps_Map.openedInfo.close(),$('dd[data-id = "'+r+'"]').each(function(){var a,e,o;return e=$(this).find(".marker-name").val(),o=$(this).find(".marker-text").val(),""===e&&""===o||(a='<div class="marker-info">',""!==e&&(a+="<p>"+e+"</p>"),""!==o&&$.each(o.split(/[\r\n]+/),function(){return this.match(/^https?:\/\//)?a+='<p><a href="'+this+'">'+this+"</a></p>":a+="<p>"+this+"</p>"}),Googlemaps_Map.openedInfo=new google.maps.InfoWindow({content:a,maxWidth:260}),Googlemaps_Map.openedInfo.open(Googlemaps_Map.markers[r].getMap(),Googlemaps_Map.markers[r])),!1})})},t.geocoderSearch=function(a){return(new google.maps.Geocoder).geocode({address:a,region:"jp"},function(a,e){var o;e===google.maps.GeocoderStatus.OK?(o=a[0],Googlemaps_Map.map.setCenter(o.geometry.location),o.geometry.viewport&&Googlemaps_Map.map.fitBounds(o.geometry.viewport)):alert("\u5ea7\u6a19\u3092\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002")}),!1},t.clonePointForm=function(){var a;$(".mod-map dd.marker").length<t.maxPointForm&&((a=$(".mod-map dd.marker:last").clone(!1).insertAfter($(".mod-map dd.marker:last"))).attr("data-id",t.dataID),t.dataID+=1,a.find("input,textarea").val(""),a.find(".marker-name").val(""),a.find(".clear-marker").on("click",function(){return t.clearPointForm(a)}),a.find(".set-marker").on("click",function(){return t.createMarker(a)}),a.find(".marker-name").on("keypress",function(a){if(13===a.which)return!1}),a.find(".marker-loc-input").on("keypress",function(a){if(13===a.which)return $(this).closest("dd.marker").find(".set-marker").trigger("click"),!1}),a.find(".marker-loc-input").on("focus",function(){if(null!==t.clickMarker)return t.clickMarker.setMap(null),$(".mod-map .clicked").val("")})),$(".mod-map dd.marker").length===t.maxPointForm&&$(".mod-map dd .add-marker").parent().hide()},t.clearPointForm=function(a){""!==a.find(".marker-loc").val()?confirm(t.deleteMessage)&&(Googlemaps_Map.markers[parseInt(a.attr("data-id"))]&&Googlemaps_Map.markers[parseInt(a.attr("data-id"))].setMap(null),a.find("input,textarea").val(""),1<$(".mod-map dd.marker").length&&a.remove()):(Googlemaps_Map.markers[parseInt(a.attr("data-id"))]&&Googlemaps_Map.markers[parseInt(a.attr("data-id"))].setMap(null),a.find("input,textarea").val(""),1<$(".mod-map dd.marker").length&&a.remove()),$(".mod-map dd .add-marker").parent().show()},t.createMarker=function(a){var e,o;if(o=null,""!==$(".mod-map .clicked").val()?o=$(".mod-map .clicked").val():""!==a.find(".marker-loc-input").val()&&(t.validateLoc(a.find(".marker-loc-input"))?o=a.find(".marker-loc-input").val():alert("\u6b63\u3057\u3044\u5ea7\u6a19\u3092\u30ab\u30f3\u30de(,)\u533a\u5207\u308a\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4f8b\uff0933.8957612,133.6806607")),o)return a.find(".marker-loc").val(o),a.find(".marker-loc-input").val(o),e=parseInt(a.attr("data-id")),Googlemaps_Map.markers[e]&&Googlemaps_Map.markers[e].setMap(null),Googlemaps_Map.markers[e]=new google.maps.Marker({position:t.getMapLoc(a.find(".marker-loc")),map:Googlemaps_Map.map}),t.attachMessage(e),t.clickMarker?($(".mod-map .clicked").val(""),t.clickMarker.setMap(null)):void 0},t.renderMarkers=function(){var a,e,o;if(o=new google.maps.LatLngBounds,Googlemaps_Map.markers){var r=Googlemaps_Map.markers;for(a=0,e=r.length;a<e;a++){r[a].setMap(null)}}Googlemaps_Map.markers=[],t.dataID=0,$(".mod-map dd.marker").each(function(){if($(this).attr("data-id",t.dataID),""!==$(this).find(".marker-loc").val()){var a=t.getMapLoc($(this).find(".marker-loc"));Googlemaps_Map.markers[t.dataID]=new google.maps.Marker({position:a,map:Googlemaps_Map.map}),t.attachMessage(t.dataID),o.extend(a)}t.dataID+=1}),0===Googlemaps_Map.markers.length?Googlemaps_Map.map.setCenter(new google.maps.LatLng(Googlemaps_Map.center[0],Googlemaps_Map.center[1])):(Googlemaps_Map.map.fitBounds(o),google.maps.event.addListenerOnce(Googlemaps_Map.map,"idle",function(){Googlemaps_Map.map.getZoom()>Googlemaps_Map.zoom&&Googlemaps_Map.map.setZoom(Googlemaps_Map.zoom)}))},t.renderEvents=function(){return google.maps.event.addListener(Googlemaps_Map.map,"click",function(a){return t.setMapLoc($(".mod-map .clicked"),a.latLng.lat(),a.latLng.lng()),null!==t.clickMarker&&t.clickMarker.setMap(null),t.clickMarker=new google.maps.Marker({position:new google.maps.LatLng(a.latLng.lat(),a.latLng.lng()),icon:t.clickIcon,map:Googlemaps_Map.map})}),google.maps.event.addListener(Googlemaps_Map.map,"bounds_changed",function(){var a=Googlemaps_Map.map.getZoom();$('input[name="item[map_zoom_level]"]').val(a)}),$(".mod-map .add-marker").on("click",function(){return t.clonePointForm(),!1}),$(".mod-map .clear-marker").on("click",function(){return t.clearPointForm($(this).closest("dd.marker")),!1}),$(".mod-map .set-marker").on("click",function(){return t.createMarker($(this).closest("dd.marker")),!1}),$(".mod-map .location-search button").on("click",function(){return t.geocoderSearch($(".mod-map .keyword").val()),!1}),$(".mod-map .keyword").on("keypress",function(a){if(13===a.which)return t.geocoderSearch($(this).val()),!1}),$(".mod-map .marker-name").on("keypress",function(a){if(13===a.which)return!1}),$(".mod-map .marker-loc-input").on("keypress",function(a){if(13===a.which)return $(this).closest("dd.marker").find(".set-marker").trigger("click"),!1}),$(".mod-map .marker-loc-input").on("focus",function(){if(null!==t.clickMarker)return t.clickMarker.setMap(null),$(".mod-map .clicked").val("")})},t}();